services:
  - type: web
    name: skillsync-backend
    env: python
    plan: free
    region: oregon
    buildCommand: |
      pip install -r backend/requirements.txt
      python backend/manage.py collectstatic --noinput
    startCommand: |
      gunicorn skill_sync.wsgi:application -w 2 -k gthread -b 0.0.0.0:$PORT
    postdeploy: |
      python backend/manage.py migrate
    envVars:
      - key: PYTHON_VERSION
        value: 3.11
      - key: DEBUG
        value: "False"
      - key: ALLOWED_HOSTS
        # Render provides RENDER_EXTERNAL_HOSTNAME automatically
        value: ${RENDER_EXTERNAL_HOSTNAME}
      - key: SECRET_KEY
        generateValue: true
      # Set this after you deploy the frontend:
      - key: CORS_ALLOWED_ORIGINS
        value: https://YOUR_NETLIFY_SITE.netlify.app
